@(
    member: com.gu.membership.salesforce.Member,
    targetTier: com.gu.membership.salesforce.Tier,
    userFields: model.PrivateFields,
    pageInfo: model.PageInfo,
    cardOpt: Option[com.gu.membership.stripe.Stripe.Card]
)(implicit token: play.filters.csrf.CSRF.Token)

@import helper._

@main("Change Tier | " + targetTier + " from " + member.tier, pageInfo = pageInfo) {

    <main role="main" class="page-content">

        <section class="page-header">
            <h1 class="page-headline">Payment</h1>
            @fragments.joiner.signedInAs(routes.TierController.upgradeConfirm(targetTier).url)
        </section>

        <section class="form-section form-section--no-padding">
            <div class="form-section__content">
            @fragments.form.errorMessageDisplay()
            </div>
        </section>

        <section class="form-section">

            <div class="form-section__content">

                <form action="@routes.TierController.upgrade(targetTier)" method="POST" id="payment-form"
                      class="form js-form" data-change-to-tier="@targetTier">
                    @CSRF.formField
                    @fragments.form.addressDetail(
                        "Delivery address",
                        "Once you've joined Guardian Membership we'll send you a welcome pack in the post.",
                        "deliveryAddress", true, Some(member.deliveryAddress)
                    )
                    @if(cardOpt.isEmpty) {
                        @fragments.form.paymentOptions(targetTier)
                    }
                    @fragments.form.billingAddress("Billing address")
                    @fragments.form.addressDetail(
                        "", "", "billingAddress", true, Some(member.billingAddress)
                    )
                    @fragments.form.cardDetail(targetTier, cardOpt)
                    @fragments.form.submit("Pay", "now", Some(targetTier))
                </form>

            </div>

        </section>

    </main>
}
